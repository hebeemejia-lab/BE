# ğŸ”„ Diagrama de Flujos - PayPal Payouts & Retiros Manuales

## 1. FLUJO GENERAL DEL DINERO

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    BANCO EXCLUSIVO - DINERO                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

   ENTRADAS                         BD DEL USUARIO              SALIDAS
   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PayPal   â”‚                                              â”‚ PayPal   â”‚
â”‚ LIVE     â”‚ â”€â”€â”€â”€ RECARGA â”€â”€â†’ [Saldo del Usuario] â”€â”€â†’   â”‚ Payouts  â”‚
â”‚ Compra   â”‚                                              â”‚ LIVE     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ âœ… DINERO REAL ENTRA                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                          âœ… DINERO REAL SALE

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Stripe   â”‚ â”€â”€â”€â”€ RECARGA â”€â”€â†’ [Saldo del Usuario]
â”‚ TEST     â”‚                 (no activo)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
âŒ TEST (sin dinero real)

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Rapyd    â”‚ â”€â”€â”€â”€ RECARGA â”€â”€â†’ [Saldo del Usuario]
â”‚ SANDBOX  â”‚                 (no activo)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
âŒ SANDBOX (sin dinero real)
```

---

## 2. FLUJO: USUARIO SOLICITA RETIRO

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ USUARIO SOLICITA RETIRO                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

OPCIÃ“N A: PayPal Payout AutomÃ¡tico (InstantÃ¡neo)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Usuario solicita â”‚
â”‚ retiro           â”‚
â”‚ Monto: $100      â”‚
â”‚ MÃ©todo: PayPal   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ VALIDACIONES                             â”‚
â”‚ âœ“ Saldo suficiente ($100 > $0)          â”‚
â”‚ âœ“ Email vÃ¡lido                          â”‚
â”‚ âœ“ Cuenta bancaria verificada            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”œâ”€ âŒ Falla â†’ [CREAR SOLICITUD MANUAL]
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ LLAMADA A PAYPAL PAYOUTS API             â”‚
â”‚ POST /v1/payments/payouts                â”‚
â”‚ {                                        â”‚
â”‚   monto: 100,                           â”‚
â”‚   currency: USD,                         â”‚
â”‚   receiver: juan@email.com,              â”‚
â”‚   reference: RET-1234567890              â”‚
â”‚ }                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”œâ”€ âŒ Error â†’ [CREAR SOLICITUD MANUAL]
         â”‚   (credenciales, cuenta bloqueada, etc)
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Ã‰XITO: DINERO TRANSFERIDO                â”‚
â”‚ âœ… PayPal crea transacciÃ³n               â”‚
â”‚ âœ… Dinero sale de BD del usuario         â”‚
â”‚ Saldo: $100 â†’ $0                         â”‚
â”‚ Estado: "exitosa"                        â”‚
â”‚ Batch ID: pay_abc123xyz                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ RESPUESTA AL USUARIO                     â”‚
â”‚ HTTP 200 OK                              â”‚
â”‚ {                                        â”‚
â”‚   "mensaje": "Retiro procesado",         â”‚
â”‚   "batchId": "pay_abc123xyz",            â”‚
â”‚   "estado": "exitosa",                   â”‚
â”‚   "nuevoSaldo": 0                        â”‚
â”‚ }                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


OPCIÃ“N B: Solicitud Manual (Requiere AprobaciÃ³n)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Usuario solicita â”‚
â”‚ retiro           â”‚
â”‚ Monto: $50       â”‚
â”‚ MÃ©todo: Manual   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ VALIDACIONES                             â”‚
â”‚ âœ“ Saldo suficiente ($50 > $0)           â”‚
â”‚ âœ“ Cuenta bancaria verificada            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”œâ”€ âŒ Falla â†’ ERROR (no procede)
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ CREAR SOLICITUD EN BD                    â”‚
â”‚ tabla: solicitudes_retiro_manual          â”‚
â”‚ {                                        â”‚
â”‚   usuarioId: 5,                          â”‚
â”‚   monto: 50,                             â”‚
â”‚   estado: "pendiente",                   â”‚
â”‚   metodo: "transferencia_manual",        â”‚
â”‚   numeroReferencia: "RET-1234567890",    â”‚
â”‚   banco: "BanReservas",                  â”‚
â”‚   nombreBeneficiario: "Juan PÃ©rez",      â”‚
â”‚ }                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ RESERVAR DINERO                          â”‚
â”‚ Saldo del usuario: $100 â†’ $50            â”‚
â”‚ (Dinero se "congela" esperando aprobaciÃ³nâ”‚
â”‚  Si se rechaza, se devuelve)             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ RESPUESTA AL USUARIO                     â”‚
â”‚ HTTP 202 ACCEPTED                        â”‚
â”‚ {                                        â”‚
â”‚   "mensaje": "Solicitud pendiente",      â”‚
â”‚   "solicitudId": 42,                     â”‚
â”‚   "estado": "pendiente_aprobacion",      â”‚
â”‚   "numeroReferencia": "RET-1234567890"   â”‚
â”‚ }                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
   [ESPERAR APROBACIÃ“N DE ADMIN]
```

---

## 3. FLUJO: ADMIN GESTIONA SOLICITUDES

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ADMIN VE PANEL DE SOLICITUDES                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

GET /admin/solicitudes-retiro?estado=pendiente
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ BD: solicitudes_retiro_manual        â”‚
â”‚                                      â”‚
â”‚ ID â”‚ Usuario  â”‚ Monto â”‚ Estado â”‚    â”‚
â”‚â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”‚
â”‚ 42 â”‚ Juan     â”‚ $50   â”‚ PEND   â”‚    â”‚
â”‚ 43 â”‚ MarÃ­a    â”‚ $100  â”‚ PEND   â”‚    â”‚
â”‚ 44 â”‚ Carlos   â”‚ $25   â”‚ PEND   â”‚    â”‚
â”‚    â”‚ ...      â”‚ ...   â”‚ ...    â”‚    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
   ADMIN ELIGE: Â¿Aprobar o Rechazar?
         â”‚
         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚                 â”‚                  â”‚
         â–¼                 â–¼                  â–¼

   [APROBAR]         [RECHAZAR]       [VER ESTADO]
   â•â•â•â•â•â•â•â•â•â•â•â•â•     â•â•â•â•â•â•â•â•â•â•â•â•     â•â•â•â•â•â•â•â•â•â•â•


ESCENARIO 1: ADMIN APRUEBA
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

POST /admin/solicitudes-retiro/42/aprobar
{
  "notasAdmin": "Aprobado por verificaciÃ³n completada"
}
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PROCESAR PAYPAL PAYOUT                   â”‚
â”‚ Usar la solicitud de la BD                â”‚
â”‚ {                                        â”‚
â”‚   monto: 50,                            â”‚
â”‚   email: juan@email.com,                 â”‚
â”‚   referencia: RET-1234567890             â”‚
â”‚ }                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”œâ”€ âŒ Error â†’ Rechazar solicitud
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ACTUALIZAR SOLICITUD EN BD               â”‚
â”‚ estado: "pendiente" â†’ "procesada"        â”‚
â”‚ procesadoPor: (admin ID)                 â”‚
â”‚ fechaProcesamiento: (ahora)              â”‚
â”‚ batchIdPayPal: pay_xyz789                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ CREAR REGISTRO EN TABLA RECARGAS         â”‚
â”‚ metodo: "paypal_payout"                  â”‚
â”‚ estado: "exitosa"                        â”‚
â”‚ stripePaymentId: pay_xyz789              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ RESPUESTA AL ADMIN                       â”‚
â”‚ HTTP 200 OK                              â”‚
â”‚ {                                        â”‚
â”‚   "mensaje": "Aprobado y procesado",     â”‚
â”‚   "batchId": "pay_xyz789",               â”‚
â”‚   "estado": "procesada"                  â”‚
â”‚ }                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


ESCENARIO 2: ADMIN RECHAZA
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

POST /admin/solicitudes-retiro/42/rechazar
{
  "razonRechazo": "Datos bancarios incorrectos"
}
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ACTUALIZAR SOLICITUD EN BD               â”‚
â”‚ estado: "pendiente" â†’ "rechazada"        â”‚
â”‚ razonRechazo: "Datos incorrectos"        â”‚
â”‚ procesadoPor: (admin ID)                 â”‚
â”‚ fechaProcesamiento: (ahora)              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ DEVOLVER DINERO AL USUARIO               â”‚
â”‚ Saldo: $50 â†’ $100                        â”‚
â”‚ (El dinero "congelado" se libera)        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ RESPUESTA AL ADMIN                       â”‚
â”‚ HTTP 200 OK                              â”‚
â”‚ {                                        â”‚
â”‚   "mensaje": "Rechazado y reembolsado",  â”‚
â”‚   "dineroDevuelto": 50,                  â”‚
â”‚   "estado": "rechazada"                  â”‚
â”‚ }                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 4. FLUJO: VERIFICAR ESTADO EN PAYPAL

```
GET /admin/solicitudes-retiro/42/estado
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ OBTENER BATCH ID DE LA SOLICITUD         â”‚
â”‚ batchIdPayPal: "pay_xyz789"              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ LLAMAR PAYPAL API                        â”‚
â”‚ GET /v1/payments/payouts/pay_xyz789      â”‚
â”‚ (con Bearer token de PayPal)             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ RESPUESTA DE PAYPAL                      â”‚
â”‚ {                                        â”‚
â”‚   "batch_header": {                      â”‚
â”‚     "payout_batch_id": "pay_xyz789",     â”‚
â”‚     "batch_status": "SUCCESS",           â”‚
â”‚     "time_created": "2026-01-31T15:30"   â”‚
â”‚   },                                     â”‚
â”‚   "items": [{                            â”‚
â”‚     "status": "SUCCESS",                 â”‚
â”‚     "payout_item_id": "item_123",        â”‚
â”‚     "amount": { "value": "50", ... }     â”‚
â”‚   }]                                     â”‚
â”‚ }                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ RESPUESTA AL ADMIN                       â”‚
â”‚ HTTP 200 OK                              â”‚
â”‚ {                                        â”‚
â”‚   "solicitud": { ... },                  â”‚
â”‚   "estadoPayPal": {                      â”‚
â”‚     "estado": "SUCCESS",                 â”‚
â”‚     "items": [...]                       â”‚
â”‚   }                                      â”‚
â”‚ }                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 5. TABLA DE ESTADOS

```
ESTADO DEL USUARIO (tabla: recargas)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Monto    â”‚ MÃ©todo         â”‚ Estado                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ $100     â”‚ paypal (entr)  â”‚ exitosa   (dinero entra) â”‚
â”‚ $50      â”‚ paypal_payout  â”‚ exitosa   (dinero sale)  â”‚
â”‚ $30      â”‚ retiro (old)   â”‚ exitosa   (deprecated)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


ESTADO DE SOLICITUD (tabla: solicitudes_retiro_manual)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Estado       â”‚ Significado                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ pendiente    â”‚ Creada, esperando aprobaciÃ³n de admin    â”‚
â”‚ aprobada     â”‚ Admin aprobÃ³ (sin procesar aÃºn)          â”‚
â”‚ procesada    â”‚ Admin aprobÃ³ + PayPal Payout procesado   â”‚
â”‚ rechazada    â”‚ Admin rechazÃ³ + dinero devuelto          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 6. CASOS DE Ã‰XITO Y ERROR

```
CASO 1: Flujo Exitoso PayPal Payout
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Usuario: $100 saldo
    â”‚
    â–¼
Solicita retiro: $50 (PayPal Payout)
    â”‚
    â”œâ”€ Validaciones: âœ… TODAS PASAN
    â”‚
    â”œâ”€ PayPal API: âœ… Ã‰XITO
    â”‚
    â”œâ”€ Saldo: $100 â†’ $50 âœ…
    â”‚
    â””â”€ Estado: exitosa âœ…

Resultado: 200 OK - Retiro completado


CASO 2: Flujo Exitoso Manual
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Usuario: $100 saldo
    â”‚
    â–¼
Solicita retiro: $30 (Manual)
    â”‚
    â”œâ”€ Validaciones: âœ… TODAS PASAN
    â”‚
    â”œâ”€ Crear solicitud: âœ…
    â”‚
    â”œâ”€ Saldo: $100 â†’ $70 (reservado) âœ…
    â”‚
    â””â”€ Estado: pendiente âœ…

Resultado: 202 Accepted - Esperando admin

    [ADMIN APRUEBA]
    â”‚
    â”œâ”€ PayPal Payout: âœ…
    â”‚
    â”œâ”€ Solicitud: procesada âœ…
    â”‚
    â””â”€ Dinero transferido: âœ…

Resultado: 200 OK - Aprobado


CASO 3: Error - PayPal Falla
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Usuario: $100 saldo
    â”‚
    â–¼
Solicita retiro: $80 (PayPal Payout)
    â”‚
    â”œâ”€ Validaciones: âœ… PASAN
    â”‚
    â”œâ”€ PayPal API: âŒ ERROR (cuenta bloqueada)
    â”‚
    â”œâ”€ Fallback automÃ¡tico: Crear solicitud manual âœ…
    â”‚
    â”œâ”€ Saldo: $100 â†’ $20 (reservado) âœ…
    â”‚
    â””â”€ Estado: pendiente (con notas de error) âœ…

Resultado: 202 Accepted - Creada solicitud manual

    [ADMIN APRUEBA DESPUÃ‰S]
    â”‚
    â””â”€ Dinero transferido manualmente âœ…


CASO 4: Error - Saldo Insuficiente
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Usuario: $10 saldo
    â”‚
    â–¼
Solicita retiro: $50 (cualquier mÃ©todo)
    â”‚
    â”œâ”€ Validaciones: âŒ FALLA (saldo < monto)
    â”‚
    â””â”€ Saldo: $10 (sin cambios) âœ…

Resultado: 400 Bad Request - Saldo insuficiente


CASO 5: Error - Email InvÃ¡lido
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Usuario: sin email (o email invÃ¡lido)
    â”‚
    â–¼
Solicita retiro: $50 (PayPal Payout)
    â”‚
    â”œâ”€ Validaciones: âŒ FALLA (email invÃ¡lido)
    â”‚
    â””â”€ Saldo: $50 (sin cambios) âœ…

Resultado: 400 Bad Request - Email invÃ¡lido
           â†’ Crear solicitud manual automÃ¡ticamente
```

---

## 7. RESUMEN DE FLUJOS

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ FLUJO 1: USUARIO â†’ RETIRO PAYPAL PAYOUT (AutomÃ¡tico)            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  POST /retiros/procesar                                         â”‚
â”‚    â”‚                                                             â”‚
â”‚    â”œâ”€ Validar â”€â”€â”¬â”€ OK â”€â”€â”                                      â”‚
â”‚    â”‚            â”‚       â”‚                                        â”‚
â”‚    â”‚            â””â”€ ERRORâ”€â”€â†’ 400 Bad Request                     â”‚
â”‚    â”‚                                                             â”‚
â”‚    â””â”€ PayPal Payout â”€â”€â”¬â”€ Ã‰XITO â”€â”€â†’ 200 OK (DINERO TRANSFERIDO) â”‚
â”‚                       â”‚                                          â”‚
â”‚                       â””â”€ ERROR â”€â”€â†’ 202 (Crear solicitud manual)  â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ FLUJO 2: USUARIO â†’ RETIRO MANUAL (Espera AprobaciÃ³n)            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  POST /retiros/procesar                                         â”‚
â”‚    â”‚                                                             â”‚
â”‚    â”œâ”€ Validar â”€â”€â”¬â”€ OK â”€â”€â”                                      â”‚
â”‚    â”‚            â”‚       â”‚                                        â”‚
â”‚    â”‚            â””â”€ ERRORâ”€â”€â†’ 400 Bad Request                     â”‚
â”‚    â”‚                                                             â”‚
â”‚    â””â”€ Crear solicitud â”€â”€â†’ 202 Accepted (PENDIENTE)             â”‚
â”‚         (dinero reservado)                                       â”‚
â”‚                                                                  â”‚
â”‚    [ADMIN APRUEBA / RECHAZA]                                    â”‚
â”‚         â”‚                  â”‚                                      â”‚
â”‚         â”œâ”€ APRUEBA â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â†’ PayPal Payout â”€â”€â†’ 200 OK        â”‚
â”‚         â”‚                  â”‚                                      â”‚
â”‚         â””â”€ RECHAZA â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â†’ Dinero devuelto â”€â”€â†’ 200 OK      â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ FLUJO 3: ADMIN â†’ GESTIONAR SOLICITUDES                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  GET /admin/solicitudes-retiro                                  â”‚
â”‚    â””â”€â†’ Ver todas las solicitudes pendientes                     â”‚
â”‚                                                                  â”‚
â”‚  GET /admin/solicitudes-retiro/:id/estado                       â”‚
â”‚    â””â”€â†’ Ver estado detallado + estado en PayPal                  â”‚
â”‚                                                                  â”‚
â”‚  POST /admin/solicitudes-retiro/:id/aprobar                     â”‚
â”‚    â””â”€â†’ Aprueba + procesa PayPal Payout automÃ¡ticamente          â”‚
â”‚                                                                  â”‚
â”‚  POST /admin/solicitudes-retiro/:id/rechazar                    â”‚
â”‚    â””â”€â†’ Rechaza + devuelve dinero al usuario                     â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

**Nota**: Todos los flujos estÃ¡n implementados y listos para usar.
**Dinero**: Es 100% REAL en PayPal Live. Verifica las credenciales.
